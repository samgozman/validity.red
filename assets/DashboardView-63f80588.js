import{d as c,o as n,c as i,a as t,h,j as O,u as d,k as A,t as l,b as u,i as D,R as T,F as m,r as v,Q as y,l as B,g as b,w as g,f as w,m as L,s as C,n as $,E as S,p as R,q as E,x as V,y as j,z as W,B as H,S as U}from"./index-ca8ec35b.js";import{D as I,a as Y}from"./DocumentType-69b8dd92.js";import{N as G}from"./NotificationsOutline-49353b83.js";const z={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},P=t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M328 112L184 256l144 144"},null,-1),Q=[P],q=c({name:"ChevronBackOutline",render:function(e,o){return n(),i("svg",z,Q)}}),J={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},K=t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M184 112l144 144l-144 144"},null,-1),X=[K],Z=c({name:"ChevronForwardOutline",render:function(e,o){return n(),i("svg",J,X)}}),tt={class:"px-4 py-1"},et={class:"flex justify-between"},st=c({__name:"UsedTypesItem",props:{usedType:null},setup(s){return(e,o)=>(n(),i("li",tt,[t("a",et,[t("span",null,[(n(),h(O(d(I).getIcon(s.usedType.type)),{class:"w-4 inline"})),A(" "+l(d(I).getName(s.usedType.type)),1)]),t("span",null,l(s.usedType.count),1)])]))}}),ot={class:"w-full"},nt={class:"truncate"},at=c({__name:"LatestDocumentsItem",props:{document:null},setup(s){return(e,o)=>(n(),i("li",ot,[u(d(T),{to:`/documents/${s.document.ID}`,class:"flex justify-between"},{default:D(()=>[(n(),h(O(d(I).getIcon(s.document.type)),{class:"w-4"})),t("span",nt,l(s.document.title),1),t("span",null,l(new Date(s.document.expiresAt).toISOString().slice(0,10)),1)]),_:1},8,["to"])]))}}),rt={class:"font-light leading-none hidden md:block md:ml-2"},it={class:"font-medium leading-none truncate md:ml-2"},lt=c({__name:"CalendarNotificationItem",props:{notification:null},setup(s){return(e,o)=>(n(),h(d(T),{to:`/documents/${s.notification.documentID}`,class:"flex items-center flex-shrink-0 h-3 md:h-5 md:px-1 text-ultra-small md:text-xs hover:bg-base-300"},{default:D(()=>[t("span",rt,l(new Date(s.notification.notificationDate).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})),1),t("span",it,l(s.notification.documentTitle),1)]),_:1},8,["to"]))}});const ct={class:"relative flex flex-col bg-base-100 group h-12 md:h-24"},dt={class:"mx-1 md:mx-2 my-1 text-xs font-bold"},ut={class:"flex flex-col px-1 md:py-1 overflow-auto"},ht=c({__name:"CalendarDay",props:{indexDay:null,notifications:null},setup(s){return(e,o)=>(n(),i("div",ct,[t("span",dt,l(s.indexDay),1),t("div",ut,[(n(!0),i(m,null,v(s.notifications,(a,r)=>(n(),h(lt,{key:r,notification:a},null,8,["notification"]))),128))])]))}});class N{static async getCalendar(){const e=await new y({route:"/calendar"}).get(),{error:o,message:a,calendar:r}=e.data;if(o)throw new B(a);return r}static createCalendar(e,o){const a=new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),r=new Map;for(let p=1;p<=a;p++){const M=o.filter(x=>{const f=new Date(x.notificationDate.split("T")[0]),k=new Date(e.getFullYear(),e.getMonth(),p);return f.toLocaleDateString("en-GB")===k.toLocaleDateString("en-GB")});r.set(p,M)}return r}}const _t={class:"flex flex-grow w-full"},mt={class:"flex flex-col flex-grow"},pt={class:"flex items-center mt-4"},ft={class:"flex"},gt=L('<div class="grid grid-cols-7 mt-4"><div class="pl-1 text-sm">Mon</div><div class="pl-1 text-sm">Tue</div><div class="pl-1 text-sm">Wed</div><div class="pl-1 text-sm">Thu</div><div class="pl-1 text-sm">Fri</div><div class="pl-1 text-sm">Sat</div><div class="pl-1 text-sm">Sun</div></div>',1),wt={class:"grid flex-grow w-full h-auto grid-cols-7 gap-px pt-px mt-1 bg-base-200 rounded-box"},vt=c({data(){return{month:new Map,currentFirstDayOfWeek:0,currentDate:new Date,currentDateString:"",errorMsg:""}},methods:{async refresh(){this.currentDate=C.value.user.calendarCurrentDate?new Date(C.value.user.calendarCurrentDate):new Date,$(this.currentDate.toString()),this.setCurrentDateString(this.currentDate),this.errorMsg="";try{const s=await N.getCalendar();this.month=N.createCalendar(this.currentDate,s)}catch(s){this.errorMsg=await S.decode(s)}},prevMonth(){this.currentDate.setMonth(this.currentDate.getMonth()-1),$(this.currentDate.toString()),this.refresh()},nextMonth(){this.currentDate.setMonth(this.currentDate.getMonth()+1),$(this.currentDate.toString()),this.refresh()},setCurrentDateString(s){const e=s.toLocaleString("default",{month:"long"}),o=s.getFullYear();this.currentDate=s,this.currentDateString=`${e}, ${o}`;const a=new Map([[0,6],[1,0],[2,1],[3,2],[4,3],[5,4],[6,5]]),r=new Date(s.getFullYear(),s.getMonth(),1).getDay();this.currentFirstDayOfWeek=a.get(r)||0}},beforeMount(){this.refresh()}}),xt=c({...vt,__name:"CalendarMonth",setup(s){return(e,o)=>(n(),i("div",_t,[t("div",mt,[t("div",pt,[t("div",ft,[t("button",{onClick:o[0]||(o[0]=b((...a)=>e.prevMonth&&e.prevMonth(...a),["prevent"]))},[u(d(q),{class:"w-6"})]),t("button",{onClick:o[1]||(o[1]=b((...a)=>e.nextMonth&&e.nextMonth(...a),["prevent"]))},[u(d(Z),{class:"w-6"})])]),g(t("h2",{class:"ml-2 text-xl font-bold leading-none"},l(e.currentDateString),513),[[w,!e.errorMsg]]),g(t("h2",{class:"badge badge-error badge-outline w-full"}," Error: "+l(e.errorMsg),513),[[w,e.errorMsg]])]),gt,t("div",wt,[(n(!0),i(m,null,v(e.currentFirstDayOfWeek,a=>(n(),i("div",{key:a}))),128)),(n(!0),i(m,null,v(e.month,a=>(n(),h(ht,{key:a[0],indexDay:a[0],notifications:a[1]},null,8,["indexDay","notifications"]))),128))])])]))}});class F{static async getStats(){const e=await new y({route:"/documents/statistics"}).get(),{error:o,message:a,totalDocuments:r,totalNotifications:p,usedTypes:M,latestDocuments:x}=e.data;if(o)throw new B(a);for(const f of x)f.expiresAt=new Date(f.expiresAt).toISOString().substring(0,10);return{totalDocuments:r,totalNotifications:p,usedTypes:M.sort((f,k)=>f.count<k.count?1:-1),latestDocuments:x}}static async getIcsFile(e){return(await new y({route:`/ics/${e}`}).get()).data}}const _=s=>(j("data-v-4f9ff85e"),s=s(),W(),s),yt=_(()=>t("div",{class:"hidden xl:flex card xl:col-span-4 row-span-1 shadow-lg compact bg-base-100"},[t("div",{class:"flex-row items-center card-body"},[t("h3",{class:"text-xl font-bold"},"Sync with your calendar app")])],-1)),bt={class:"card col-span-full xl:col-span-3 row-span-1 shadow-lg compact bg-base-100"},Dt={class:"flex-col items-center card-body"},Mt=_(()=>t("h3",{class:"xl:hidden text-center sm:text-left text-xl font-bold w-full"}," Sync with your calendar app ",-1)),kt={class:"form-control w-full md:flex-row"},$t={class:"input-group w-full"},Ct=["value"],St=_(()=>t("a",{href:"#open-how-to-modal",class:"btn mt-3 md:ml-3 md:mt-0"}," How to sync? ",-1)),It={class:"card col-span-full row-span-1 shadow-lg compact bg-base-100 min-h-[40vh]"},Tt={class:"flex-col sm:flex-row items-center card-body"},Nt={class:"card col-span-3 row-span-3 shadow-lg compact bg-base-100"},Ft={class:"flex-col sm:flex-row items-center card-body"},Ot={class:"stat"},At={class:"stat-figure text-secondary stats-icon"},Bt=_(()=>t("div",{class:"stat-title"},"Documents",-1)),Lt={class:"stat-value"},Rt={class:"stat-desc"},Et=_(()=>t("div",{class:"divider divider-vertical sm:divider-horizontal"},null,-1)),Vt={class:"stat"},jt={class:"stat-figure text-secondary stats-icon"},Wt=_(()=>t("div",{class:"stat-title"},"Notifications",-1)),Ht={class:"stat-value"},Ut={class:"stat-desc"},Yt={class:"card col-span-2 row-span-4 shadow-lg compact bg-base-100"},Gt={class:"flex-col items-center card-body"},zt=_(()=>t("h3",{class:"card-title text-primary text-left w-full px-4"}," Most used types ",-1)),Pt={class:"w-full sm:max-h-36 overflow-y-auto"},Qt={class:"h-full"},qt={class:"card col-span-2 row-span-4 shadow-lg compact bg-base-100"},Jt={class:"flex-col items-center card-body"},Kt=_(()=>t("h3",{class:"card-title text-primary text-left w-full px-4"}," Latest documents ",-1)),Xt={class:"menu flex-row w-full sm:max-h-36 overflow-y-auto"},Zt={class:"h-full"},te={class:"card col-span-3 row-span-1 shadow-lg compact bg-base-100"},ee={class:"flex-col sm:flex-row items-center card-body"},se={class:"badge badge-error badge-outline w-full"},oe=c({components:{HowToModal:R(()=>V(()=>import("./HowToModal-767e1e0d.js"),["assets/HowToModal-767e1e0d.js","assets/index-ca8ec35b.js","assets/index-a9887731.css"]))},data(){return{stats:{},isDocumentsAvailable:!1,avgNotifications:0,calendarId:C.value.user.calendarId,icsRoute:"",errorMsgs:[]}},methods:{async refresh(){this.errorMsgs=[],this.icsRoute=new y({route:`/ics/${this.calendarId}`}).routeUrl;try{this.stats=await F.getStats(),this.avgNotifications=this.stats.totalNotifications/this.stats.totalDocuments||0,this.isDocumentsAvailable=this.stats.totalDocuments>0}catch(s){this.errorMsgs.push(await S.decode(s))}},async getIcs(){this.errorMsgs=[];try{const s=await F.getIcsFile(this.calendarId||""),e=document.createElement("a");e.href=window.URL.createObjectURL(new Blob([s],{type:"text/calendar"})),e.setAttribute("download","validity-calendar.ics"),document.body.appendChild(e),e.click(),e.remove()}catch(s){this.errorMsgs.push(await S.decode(s))}},copyToClipboard(){navigator.clipboard.writeText(this.icsRoute)}},beforeMount(){this.refresh()}}),ne=c({...oe,__name:"DashboardStats",setup(s){return(e,o)=>{const a=E("HowToModal");return n(),i(m,null,[yt,t("div",bt,[t("div",Dt,[Mt,t("div",kt,[t("div",$t,[t("input",{type:"text",class:"input input-bordered w-full",value:e.icsRoute,readonly:""},null,8,Ct),t("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=b(r=>e.copyToClipboard(),["prevent"]))}," Copy link ")]),St,u(a,{modalId:"open-how-to-modal"})])])]),t("div",It,[t("div",Tt,[u(xt)])]),t("div",Nt,[t("div",Ft,[t("div",Ot,[t("div",At,[u(d(Y),{class:"w-10"})]),Bt,t("div",Lt,l(e.stats.totalDocuments),1),t("div",Rt," With "+l(e.stats.usedTypes?e.stats.usedTypes.length:0)+" types ",1)]),Et,t("div",Vt,[t("div",jt,[u(d(G),{class:"w-10"})]),Wt,t("div",Ht,l(e.stats.totalNotifications),1),t("div",Ut," Avg notifications per document - "+l(e.avgNotifications.toFixed(2)),1)])])]),t("div",Yt,[t("div",Gt,[zt,t("ul",Pt,[(n(!0),i(m,null,v(e.stats.usedTypes,r=>(n(),h(st,{key:r.type,usedType:r},null,8,["usedType"]))),128))]),g(t("p",Qt,"Add any documents",512),[[w,!e.isDocumentsAvailable]])])]),t("div",qt,[t("div",Jt,[Kt,t("ul",Xt,[(n(!0),i(m,null,v(e.stats.latestDocuments,r=>(n(),h(at,{key:r.ID,document:r},null,8,["document"]))),128))]),g(t("p",Zt,"Add any documents",512),[[w,!e.isDocumentsAvailable]]),u(d(T),{to:"/documents",class:"btn xl:btn-sm w-full btn-primary"},{default:D(()=>[A(" View all documents ")]),_:1})])]),t("div",te,[t("div",ee,[g(t("p",null,"Export Validity.Red calendar .ics file",512),[[w,e.errorMsgs]]),(n(!0),i(m,null,v(e.errorMsgs,r=>(n(),i("span",se," Error: "+l(r),1))),256)),g(t("button",{onClick:o[1]||(o[1]=b((...r)=>e.getIcs&&e.getIcs(...r),["prevent"])),class:"btn btn-primary btn-sm"}," Export calendar ",512),[[w,e.errorMsgs]])])])],64)}}});const ae=H(ne,[["__scopeId","data-v-4f9ff85e"]]),re={class:"grid grid-cols-1 gap-y-6 xl:gap-x-6 py-6 lg:p-10 xl:grid-cols-7 lg:bg-base-200 rounded-box"},ie=c({created(){document.title="Dashboard | Validity.Red"}}),ue=c({...ie,__name:"DashboardView",setup(s){return(e,o)=>(n(),h(U,null,{default:D(()=>[t("div",re,[u(ae)])]),_:1}))}});export{ue as default};
//# sourceMappingURL=DashboardView-63f80588.js.map
