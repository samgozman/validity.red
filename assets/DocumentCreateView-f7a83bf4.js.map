{"version":3,"file":"DocumentCreateView-f7a83bf4.js","sources":["../../src/components/document/DocumentCreate.vue","../../src/views/DocumentCreateView.vue"],"sourcesContent":["<template>\n  <form @submit.prevent=\"submit\">\n    <div\n      class=\"grid grid-cols-1 gap-6 py-5 lg:px-10 lg:grid-cols-3 lg:bg-base-200 rounded-box\"\n    >\n      <div\n        class=\"card-card-compact card xl:card-normal col-span-1 row-span-1 shadow-lg lg:col-span-2 bg-base-100\"\n      >\n        <div class=\"card-body form-control\">\n          <h2 class=\"card-title\">Title</h2>\n          <input\n            type=\"text\"\n            placeholder=\"Document title\"\n            minlength=\"3\"\n            maxlength=\"100\"\n            class=\"input w-full\"\n            v-model=\"title\"\n          />\n          <label class=\"label\">\n            <span class=\"label-text text-base-300\">\n              Avoid unnecessary details.\n            </span>\n            <span class=\"label-text-alt text-base-300\">\n              {{ title.length }}/100\n            </span>\n          </label>\n        </div>\n      </div>\n\n      <div\n        class=\"card-card-compact card xl:card-normal col-span-1 row-span-2 shadow-lg lg:col-span-1 bg-base-100\"\n      >\n        <div class=\"card-body\">\n          <h2 class=\"card-title\">Document settings</h2>\n          <select class=\"select select-bordered w-full\" v-model=\"type\">\n            <option disabled selected>Select document type</option>\n            <option\n              v-for=\"(option, index) in typeOptions.values()\"\n              v-bind:key=\"index\"\n            >\n              {{ option.name }}\n            </option>\n          </select>\n          <div class=\"divider\">Expires at</div>\n          <label class=\"input-group\">\n            <input\n              type=\"date\"\n              :min=\"minDate\"\n              class=\"input input-bordered w-[100vw]\"\n              v-model=\"expiresAt\"\n            />\n            <span>Expiration</span>\n          </label>\n        </div>\n      </div>\n\n      <div\n        class=\"card-card-compact card xl:card-normal col-span-1 row-span-2 shadow-lg lg:col-span-2 bg-base-100\"\n      >\n        <div class=\"card-body form-control\">\n          <h2 class=\"card-title\">Description</h2>\n          <textarea\n            class=\"textarea h-full min-h-[20vh]\"\n            placeholder=\"Description (optional)\"\n            maxlength=\"500\"\n            v-model=\"description\"\n          ></textarea>\n          <label class=\"label\">\n            <span class=\"label-text text-base-300\">\n              Avoid unnecessary details. We don't need exact information about\n              your document. <br />\n              Please use this field only to distinguish documents from each\n              other.\n            </span>\n            <span class=\"label-text-alt text-base-300\">\n              {{ description.length }}/500\n            </span>\n          </label>\n        </div>\n      </div>\n      <div\n        class=\"card-card-compact card xl:card-normal col-span-1 row-span-1 shadow-lg lg:col-span-1 bg-base-100\"\n      >\n        <div class=\"card-body\">\n          <div v-if=\"!isEditMode\" class=\"form-control\">\n            <label class=\"label cursor-pointer\">\n              <span class=\"label-text\">Add default notification?</span>\n              <input type=\"checkbox\" class=\"toggle toggle-primary\"\n              v-model=\"createDefaultNotification\" checked:=\"true\" />\n            </label>\n          </div>\n          <button class=\"btn btn-primary\" type=\"submit\">Save</button>\n          <div v-show=\"errorMsg\" class=\"badge badge-error badge-outline w-full\">\n            {{ errorMsg }}\n          </div>\n        </div>\n      </div>\n    </div>\n  </form>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\nimport { DocumentService } from \"./DocumentService\";\nimport { NotificationService } from \"./NotificationService\";\nimport { DocumentType } from \"./DocumentType\";\nimport { ErrorDecoder } from \"@/services/ErrorDecoder\";\n\nexport default defineComponent({\n  data() {\n    return {\n      title: \"\",\n      description: \"\",\n      type: \"Select document type\",\n      minDate: new Date().toISOString().split(\"T\")[0],\n      expiresAt: \"\",\n      createDefaultNotification: true,\n      typeOptions: DocumentType.types,\n      documentTypeId: 0,\n      isEditMode: false,\n      documentId: \"\",\n      errorMsg: \"\",\n    };\n  },\n  methods: {\n    isEmpty(str: string, msg: string): boolean {\n      if (str === \"\") {\n        this.errorMsg = msg;\n        return true;\n      }\n      return false;\n    },\n    isLonger(str: string, len: number, msg: string) {\n      if (str.length > len) {\n        this.errorMsg = msg;\n        return true;\n      }\n      return false;\n    },\n    isValidDate(dateString: string) {\n      const parsed = Date.parse(dateString);\n      if (isNaN(parsed)) {\n        this.errorMsg = \"Invalid date. Please use the format YYYY-MM-DD\";\n        return true;\n      }\n      return false;\n    },\n    isExpired(date: Date) {\n      if (date < new Date()) {\n        this.errorMsg = \"Expiration date is in the past!\";\n        return false;\n      }\n    },\n    async createDocument(expirationDate: Date) {\n      this.documentId = await DocumentService.createOne({\n        title: this.title,\n        description: this.description,\n        type: this.documentTypeId,\n        expiresAt: expirationDate,\n      });\n    },\n    async updateDocument(expirationDate: Date) {\n      await DocumentService.updateOne({\n        id: this.documentId,\n        title: this.title,\n        description: this.description,\n        type: this.documentTypeId,\n        expiresAt: expirationDate,\n      });\n    },\n    async submit() {\n      try {\n        // 0. Clear the error message\n        this.errorMsg = \"\";\n\n        // 1. Validate form inputs\n        if (this.isEmpty(this.title, \"Title is required!\")) return;\n        if (this.isLonger(this.title, 100, \"Title is too long!\")) return;\n        if (this.isLonger(this.description, 500, \"Description is too long!\"))\n          return;\n        if (this.isEmpty(this.expiresAt, \"Expiration date is required!\"))\n          return;\n        if (this.isValidDate(this.expiresAt)) return;\n\n        const expirationDate = new Date(Date.parse(this.expiresAt));\n        const typeIndex = [...this.typeOptions.values()]\n          .map((d) => d.name)\n          .indexOf(this.type);\n        this.documentTypeId = typeIndex === -1 ? 0 : typeIndex;\n\n        if (!this.isEditMode) {\n          if (this.isExpired(expirationDate)) return;\n\n          // 2. Create document and get its id\n          await this.createDocument(expirationDate);\n          // 3. Create default notification if needed\n          if (this.createDefaultNotification) {\n            expirationDate.setHours(10);\n            await NotificationService.createOne({\n              date: expirationDate,\n              documentId: this.documentId,\n            });\n          }\n        } else {\n          // If it is the edit mode, we only need to update the document\n          await this.updateDocument(expirationDate);\n        }\n\n        // 4. Redirect to document page\n        this.$router.push({\n          name: \"document\",\n          params: { id: this.documentId },\n        });\n      } catch (error) {\n        this.errorMsg = await ErrorDecoder.decode(error);\n      }\n    },\n  },\n  async beforeMount() {\n    if (this.$route.params.id) {\n      this.createDefaultNotification = false;\n      this.isEditMode = true;\n      this.documentId =\n        typeof this.$route.params.id === \"string\" ? this.$route.params.id : \"\";\n    }\n\n    if (this.isEditMode) {\n      try {\n        const document = await DocumentService.getOne(this.documentId);\n        this.title = document.title || \"\";\n        this.description = document.description || \"\";\n        this.type = DocumentType.getName(document.type);\n        this.expiresAt = new Date(document.expiresAt)\n          .toISOString()\n          .split(\"T\")[0];\n      } catch (error) {\n        this.errorMsg = await ErrorDecoder.decode(error, this.$router);\n      }\n    }\n  },\n});\n</script>\n","<script setup lang=\"ts\">\nimport DocumentCreate from \"@/components/document/DocumentCreate.vue\";\nimport StandardContainer from \"@/components/layout/StandardContainer.vue\";\n</script>\n\n<template>\n  <StandardContainer>\n    <DocumentCreate />\n  </StandardContainer>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\n\nexport default defineComponent({\n  created() {\n    document.title = \"Create document | Validity.Red\";\n  },\n});\n</script>\n"],"names":["_sfc_main$1","defineComponent","DocumentType","str","msg","len","dateString","parsed","date","expirationDate","DocumentService","typeIndex","d","NotificationService","error","ErrorDecoder","document","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_createElementVNode","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_13","_hoisted_14","_hoisted_16","_hoisted_17","_hoisted_19","_createTextVNode","_hoisted_21","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_sfc_render","_ctx","_cache","$props","$setup","$data","$options","_withModifiers","args","$event","_vModelText","_hoisted_5","_hoisted_6","_vModelSelect","_hoisted_12","_withDirectives","_hoisted_18","_hoisted_20","_hoisted_22","_hoisted_23","_createCommentVNode","_createElementBlock","__default__"],"mappings":"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"}